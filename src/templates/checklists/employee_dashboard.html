<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –∏–∫–æ–Ω–∫–∏ –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
</head>
<body class="bg-light">

<!-- –ú–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
<nav class="navbar navbar-dark bg-primary mb-4 shadow-sm">
    <div class="container">
        <span class="navbar-brand fw-bold">üì± CheckSystem</span>
        <div class="d-flex align-items-center text-white gap-3">
            <!-- –í—ã–≤–æ–¥–∏–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
            <span class="d-none d-sm-inline">{{ user.first_name }} {{ user.last_name }} (ID: {{ user.id }})</span>

            <!-- –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ -->
            <form action="{% url 'users:logout' %}" method="post" class="d-inline">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-light text-primary fw-bold">–í—ã–π—Ç–∏</button>
            </form>
        </div>
    </div>
</nav>

<div class="container">

    <!-- –ë–ª–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π (Alerts) -->
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}
    {% endif %}


    <!-- ====================================================== -->
    <!-- –ë–õ–û–ö 1: –ê–ö–¢–£–ê–õ–¨–ù–û–ï –ó–ê–î–ê–ù–ò–ï (–ù–∞ —ç—Ç—É –Ω–µ–¥–µ–ª—é) -->
    <!-- ====================================================== -->

    {% if task %}
        <h4 class="mb-3 text-secondary">üìÖ –í–∞—à –≥—Ä–∞—Ñ–∏–∫ –Ω–∞ —ç—Ç—É –Ω–µ–¥–µ–ª—é</h4>

        <div class="card shadow-sm border-primary mb-5">
            <div class="card-body text-center p-4 p-md-5">

                <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫: –î–∞—Ç–∞ –∏ —Å—Ç–∞—Ç—É—Å -->
                {% if is_today %}
                    <h6 class="text-uppercase text-danger fw-bold mb-2">üî• –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –°–ï–ì–û–î–ù–Ø</h6>
                {% else %}
                    <h6 class="text-uppercase text-primary fw-bold mb-2">
                        üîú –ü–ª–∞–Ω–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: {{ task.date|date:"l, d E" }}
                    </h6>
                    <p class="text-muted mb-2">
                        (–ß–µ—Ä–µ–∑ {{ days_until }} –¥–Ω.)
                    </p>
                {% endif %}

                <h1 class="display-6 text-dark mb-3">{{ task.template.name }}</h1>
                <p class="lead text-muted">üìç {{ task.template.location.name }}</p>

                <hr class="my-4">

                <!-- –õ–û–ì–ò–ö–ê –ö–ù–û–ü–û–ö -->
                {% if task.inspection %}
                    <!-- –°—Ü–µ–Ω–∞—Ä–∏–π A: –ü—Ä–æ–≤–µ—Ä–∫–∞ –£–ñ–ï –ù–ê–ß–ê–¢–ê -->

                    {% if task.inspection.is_completed %}
                        <!-- A1: –ó–∞–≤–µ—Ä—à–µ–Ω–æ -->
                        <button class="btn btn-success btn-lg px-5 w-100" disabled>
                            ‚úÖ –ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
                        </button>
                        <p class="mt-2 text-muted small">–°–ø–∞—Å–∏–±–æ –∑–∞ —Ä–∞–±–æ—Ç—É!</p>
                    {% else %}
                        <!-- A2: –ß–µ—Ä–Ω–æ–≤–∏–∫ -->
                        <a href="{% url 'inspection_form' task.inspection.id %}" class="btn btn-warning btn-lg px-5 fw-bold w-100 shadow-sm" style="max-width: 400px;">
                            ‚úèÔ∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
                        </a>
                        <!-- –¢–£–¢ –ù–ï–¢ –ö–ù–û–ü–ö–ò –ê–í–¢–û–ó–ê–ú–ï–ù–´. –ù–ê–ó–ê–î –ü–£–¢–ò –ù–ï–¢. -->
                        <p class="mt-3 text-muted small">
                            <i class="bi bi-lock-fill"></i> –í—ã –Ω–∞—á–∞–ª–∏ —ç—Ç—É –ø—Ä–æ–≤–µ—Ä–∫—É. –ê–≤—Ç–æ–∑–∞–º–µ–Ω–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.
                        </p>
                    {% endif %}

                {% else %}
                    <!-- –°—Ü–µ–Ω–∞—Ä–∏–π B: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ï–©–ï –ù–ï –ù–ê–ß–ê–¢–ê (–ó–¥–µ—Å—å –ï–°–¢–¨ –∞–≤—Ç–æ–∑–∞–º–µ–Ω–∞) -->

                    <div class="d-flex flex-column gap-3 align-items-center justify-content-center">

                        <!-- –ö–Ω–æ–ø–∫–∞ 1: –ù–∞—á–∞—Ç—å -->
                        <form action="{% url 'start_inspection' task.template.id %}" method="post" class="w-100" style="max-width: 400px;">
                            {% csrf_token %}

                            {% if is_today %}
                                <button type="submit" class="btn btn-primary btn-lg w-100 fw-bold shadow-sm">
                                    üöÄ –ù–∞—á–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
                                </button>
                            {% else %}
                                <button type="button" class="btn btn-secondary btn-lg w-100 fw-bold" disabled>
                                    ‚è≥ –ë—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ {{ task.date|date:"d.m.Y" }}
                                </button>
                            {% endif %}
                        </form>

                        <!-- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å -->
                        <div class="text-muted small">- –ò–õ–ò -</div>

                        <!-- –ö–Ω–æ–ø–∫–∞ 2: –ê–≤—Ç–æ–∑–∞–º–µ–Ω–∞ -->
                        <button type="button" class="btn btn-outline-danger w-100" style="max-width: 400px;"
                                data-bs-toggle="modal" data-bs-target="#swapModal">
                            üîÑ –ù–µ –º–æ–≥—É –≤—ã–ø–æ–ª–Ω–∏—Ç—å (–ê–≤—Ç–æ–∑–∞–º–µ–Ω–∞)
                        </button>

                    </div>
                {% endif %}
            </div>
        </div>

        <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –ê–í–¢–û–ó–ê–ú–ï–ù–´ -->
        <div class="modal fade" id="swapModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header bg-danger text-white">
                        <h5 class="modal-title">‚õî –û—Ç–∫–∞–∑ –æ—Ç —Å–º–µ–Ω—ã</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <form action="{% url 'auto_swap_shift' task.id %}" method="post">
                        {% csrf_token %}
                        <div class="modal-body text-start">
                            <p>–í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫—É <strong>{{ task.date|date:"d.m.Y" }}</strong> –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –Ω–µ–¥–µ–ª—é.</p>
                            <div class="mb-3">
                                <label class="form-label fw-bold">–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É (–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label>
                                <textarea class="form-control" name="reason" rows="3" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –û—Ç–ø—É—Å–∫, –ö–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–∞..."></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                            <button type="submit" class="btn btn-danger">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

    {% else %}
        <!-- –ï—Å–ª–∏ –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ –∑–∞–¥–∞–Ω–∏–π –Ω–µ—Ç -->
        <div class="alert alert-light text-center p-5 border shadow-sm mb-5">
            <h1 class="text-muted display-4">‚òïÔ∏è</h1>
            <h3>–ù–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ –Ω–µ—Ç</h3>
            <p class="text-muted">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –Ω–µ–¥–µ–ª—é –±—É–¥–µ—Ç —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –ø–æ–∑–∂–µ.</p>
        </div>
    {% endif %}


    <!-- ====================================================== -->
    <!-- –ë–õ–û–ö 2: –ò–°–¢–û–†–ò–Ø (–û—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –±—ã–ª–æ) -->
    <!-- ====================================================== -->
    <h4 class="mb-3 text-secondary">üìÇ –ú–æ–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ç—á–µ—Ç—ã</h4>
    <div class="card shadow-sm border-0 mb-5">
        <div class="list-group list-group-flush">
            {% for inspection in my_inspections %}
                <!-- –°—Å—ã–ª–∫–∞ –≤–µ–¥–µ—Ç –Ω–∞ —Ñ–æ—Ä–º—É –ø—Ä–æ—Å–º–æ—Ç—Ä–∞/–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è -->
                <a href="{% url 'inspection_form' inspection.id %}"
                   class="list-group-item list-group-item-action d-flex justify-content-between align-items-center py-3">
                    <div>
                        <div class="fw-bold text-dark">
                            {{ inspection.template.name }}
                        </div>
                        <div class="small text-muted">
                            üìÖ {{ inspection.date_check|date:"d.m.Y" }} | üìç {{ inspection.location_snapshot }}
                        </div>
                    </div>

                    <!-- –°—Ç–∞—Ç—É—Å –æ—Ç—á–µ—Ç–∞ -->
                    {% if inspection.is_completed %}
                        <span class="badge bg-success rounded-pill">–ó–∞–≤–µ—Ä—à–µ–Ω</span>
                    {% else %}
                        <span class="badge bg-warning text-dark rounded-pill">–ß–µ—Ä–Ω–æ–≤–∏–∫</span>
                    {% endif %}
                </a>
            {% empty %}
                <div class="p-4 text-center text-muted">
                    –í—ã –µ—â–µ –Ω–µ –ø—Ä–æ–≤–æ–¥–∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–æ–∫.
                </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Bootstrap JS (–ù—É–∂–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã –ú–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞!) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
